import os
from datetime import datetime

from dotenv import load_dotenv
from pytz import timezone

load_dotenv()

CHAT_ID = "@yandex_b_notifications"
TELEGRAM_TOKEN = os.getenv("TELEGRAM_TOKEN")
STANDINGS_PAGES = [
    "https://algocode.ru/standings_data/b_fall_2023/",
    "https://algocode.ru/standings_data/b_spring_2024/"
]
time_now = lambda: datetime.now(tz=timezone("Europe/Moscow"))


class CONFIG:
    filename = f'archive/{time_now().strftime("%m-%d")}'
    data = {}
    old_data = {}
    users = {}
    user_id_by_name = {}
    page_authors = {}


messages = [
    ({"verdict": "(RT)|(TL)|(PE)|(WA)", "penalty": "1"}, [
        "*{name}* [–Ω–∞—á–∞–ª/–Ω–∞—á–∞–ª–∞] —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –∑–∞–¥–∞—á–µ–π *{task}*, –Ω–æ [–ø–æ–Ω—è–ª/–ø–æ–Ω—è–ª–∞], —á—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ.",
        "–°—Ç–æ–∏–ª–æ –ø–æ–¥—É–º–∞—Ç—å, –∞ –Ω–µ —Å—Ä–∞–∑—É –æ—Ç—Å—ã–ª–∞—Ç—å —Å–≤–æ–π –∫–æ–¥. –£ *{name}* –ø–µ—Ä–≤—ã–π —à—Ç—Ä–∞—Ñ –ø–æ –∑–∞–¥–∞—á–µ *{task}*",
        "–û–π, *{name}* [—Ä–µ—à–∏–ª/—Ä–µ—à–∏–ª–∞] –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –±–µ–∑ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏. –ü–µ—Ä–≤—ã–π —à—Ç—Ä–∞—Ñ –∑–∞ *{task}* —É–∂–µ –≤ –∫–∞—Ä–º–∞–Ω–µ.",
        "*{name}*, [–≤–∑—è–ª—Å—è/–≤–∑—è–ª–∞—Å—å] –∑–∞ –∑–∞–¥–∞—á—É *{task}*, –Ω–æ [–æ—Å–æ–∑–Ω–∞–ª/–æ—Å–æ–∑–Ω–∞–ª–∞], —á—Ç–æ –Ω–µ —Å—Ç–æ–∏–ª–æ –ø–∏—Å–∞—Ç—å –∫–æ–¥ –≤ –±–ª–æ–∫–Ω–æ—Ç–µ.",
        "*{name}*, [–ø—Ä–∏—Å—Ç—É–ø–∏–ª/–ø—Ä–∏—Å—Ç—É–ø–∏–ª–∞] –∫ –∑–∞–¥–∞—á–µ *{task}*, –Ω–æ [–∑–∞—Å—Ç—Ä—è–ª/–∑–∞—Å—Ç—Ä—è–ª–∞] –≤ —Ä–∞–∑–¥—É–º—å—è—Ö.",
        "–ù–µ —Å–ø–µ—à–∏, *{name}*, –ø–æ–¥—É–º–∞–π –µ—â–µ —Ä–∞–∑ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∫–æ–¥–∞. –®—Ç—Ä–∞—Ñ –∑–∞ –Ω–µ–≤–µ—Ä–Ω—É—é –ø–æ—Å—ã–ª–∫—É –ø–æ –∑–∞–¥–∞—á–µ *{task}* —É–∂–µ –ø—Ä–∏–ª–µ—Ç–µ–ª.",
        "–ö–∞–∑–∞–ª–æ—Å—å –±—ã, –ø—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞... –ù–æ –≤–∏–¥–∏–º–æ –Ω–µ –¥–ª—è –≤—Å–µ—Ö. *{name}* [–ø–æ–ª—É—á–∏–ª/–ø–æ–ª—É—á–∏–ª–∞] —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —à—Ç—Ä–∞—Ñ –∑–∞ –∑–∞–¥–∞—á—É *{task}*",
        "*{name}* [—Å—Ç–∞—Ä–∞–ª—Å—è/—Å—Ç–∞—Ä–∞–ª–∞—Å—å], [–ø–∏—Å–∞–ª/–ø–∏—Å–∞–ª–∞] –∫–æ–¥... –ò –≤—Å–µ —ç—Ç–æ —Ä–∞–¥–∏ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å *{verdict}* –ø–æ –∑–∞–¥–∞—á–µ *{task}*",
        "–°–Ω–æ–≤–∞ –Ω–µ—É–¥–∞—á–∞! *{name}* –Ω–µ [—Å–º–æ–≥/—Å–º–æ–≥–ª–∞] —Å–¥–∞—Ç—å –∑–∞–¥–∞—á—É *{task}* —Å –ø–µ—Ä–≤–æ–π –ø–æ–ø—ã—Ç–∫–∏",
        "*{name}* [—Ä–µ—à–∏–ª/—Ä–µ—à–∏–ª–∞], —á—Ç–æ *{verdict}* –ø–æ –∑–∞–¥–∞—á–µ *{task}* –µ–º—É –Ω—Ä–∞–≤–∏—Ç—Å—è –±–æ–ª—å—à–µ, —á–µ–º *OK*"
    ]),
    ({"verdict": "OK", "penalty": "0"}, [
        "*{name}* [—É–Ω–∏—á—Ç–æ–∂–∏–ª/—É–Ω–∏—á—Ç–æ–∂–∏–ª–∞] –∑–∞–¥–∞—á—É *{task}* —Å –ø–µ—Ä–≤–æ–π –ø–æ–ø—ã—Ç–∫–∏!",
        "*{name}* [—Å–¥–∞–ª/—Å–¥–∞–ª–∞] –∑–∞–¥–∞—á—É *{task}* —Å –ø–µ—Ä–≤–æ–π –ø–æ–ø—ã—Ç–∫–∏. –ù–∞–≤–µ—Ä–Ω–æ–µ, [–µ–º—É/–µ–π –ø—Ä–æ—Å—Ç–æ –ø–æ–≤–µ–∑–ª–æ...",
        "*{name}* –º–∞—Å—Ç–µ—Ä—Å–∫–∏ [—Å–ø—Ä–∞–≤–∏–ª—Å—è/—Å–ø—Ä–∞–≤–∏–ª–∞—Å—å] —Å –∑–∞–¥–∞—á–µ–π *{task}* —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞."
    ]),
    ({"verdict": "OK", "penalty": "[1-9][0-9]*"}, [
        "*{name}* —Å–¥–∞–ª –∑–∞–¥–∞—á—É *{task}* –ø–æ—Å–ª–µ {penalty} –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø–æ—Å—ã–ª–æ–∫.",
        "*{name}*, –∏–∑–≤–æ—Ä–∞—á–∏–≤–∞—è—Å—å –∫–∞–∫ [–∫–æ—Ç/–∫–æ—à–∫–∞], [—Å–º–æ–≥/—Å–º–æ–≥–ª–∞] –ø–æ–π–º–∞—Ç—å –∑–∞–¥–∞—á—É *{task}* —Å %{penalty} –ø–æ–ø—ã—Ç–∫–∞ ablt%, –±—É–¥—Ç–æ —ç—Ç–æ –Ω–∏—Ç—å –∏–∑ –∫–ª—É–±–∫–∞.",
        "–ó–∞–¥–∞—á–∞ *{task}* –Ω–µ –º–æ–≥–ª–∞ –ø—Ä–æ–π—Ç–∏ –º–∏–º–æ @*{name}* gent@, —Ç–∞–∫ —á—Ç–æ [–æ–Ω/–æ–Ω–∞ –µ–µ —Ä–µ—à–∏–ª –ø–æ—Å–ª–µ %{penalty} –ø–æ–ø—ã—Ç–∫–∞ gent%, —Å–ª–æ–≤–Ω–æ —Å —á–∞—à–∫–æ–π –∫–æ—Ñ–µ –≤ —Ä—É–∫–∞—Ö.",
        "*{name}* [—Ä–µ—à–∏–ª/—Ä–µ—à–∏–ª–∞] –∑–∞–¥–∞—á—É *{task}* —Å %{penalty} –ø–æ–ø—ã—Ç–∫–∞ ablt%, –∏ [–µ–≥–æ/–µ–µ] —É—Å–ø–µ—Ö –±—ã–ª —Ç–∞–∫–∏–º –≥—Ä–æ–º–∫–∏–º, —á—Ç–æ –º–æ–∂–Ω–æ –±—ã–ª–æ —É—Å–ª—ã—à–∞—Ç—å –∞–ø–ª–æ–¥–∏—Å–º–µ–Ω—Ç—ã –ø–æ –≤—Å–µ–º—É –∫—Ä—É–∂–∫—É.",
        "–ó–∞–¥–∞—á–∞ *{task}* –ø—ã—Ç–∞–ª–∞—Å—å –ø—Ä–æ—Ç–∏–≤–æ—Å—Ç–æ—è—Ç—å @*{name}* datv@, –Ω–æ [–æ–Ω/–æ–Ω–∞] —Å %{penalty} –ø–æ–ø—ã—Ç–∫–∞ ablt% [–¥–æ–∫–∞–∑–∞–ª/–¥–æ–∫–∞–∑–∞–ª–∞] –µ–π, –∫—Ç–æ –∑–¥–µ—Å—å –Ω–∞—Å—Ç–æ—è—â–∏–π –±–æ—Å—Å.",
        "[–£—á–µ–Ω–∏–∫/–£—á–µ–Ω–∏—Ü–∞] *{name}*, —Å %{penalty} –ø–æ–ø—ã—Ç–∫–∞ ablt% –Ω–∞ —Å—á–µ—Ç—É, –±–µ–∑ –ø—Ä–æ–±–ª–µ–º [—Ä–∞–∑–≥–∞–¥–∞–ª/—Ä–∞–∑–≥–∞–¥–∞–ª–∞] –∑–∞–¥–∞—á—É *{task}*, –∏ –¥–∞–∂–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤–æ—Å—Ç–æ—Ä–∂–µ–Ω–Ω–æ –∞–ø–ª–æ–¥–∏—Ä–æ–≤–∞–ª–∏.",
        "*{name}*, —Å %{penalty} –ø–æ–ø—ã—Ç–∫–∞ ablt% –≤ –∑–∞–ø–∞—Å–µ, [–ø–æ–∫–æ—Ä–∏–ª/–ø–æ–∫–æ—Ä–∏–ª–∞] –∑–∞–¥–∞—á—É *{task}*, —Å–ª–æ–≤–Ω–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã-—Ç–∞–Ω–∫–∞.",
        "–ó–∞–¥–∞—á–∞ *{task}* –ø—ã—Ç–∞–ª–∞—Å—å —Å–±–µ–∂–∞—Ç—å –æ—Ç @*{name}* gent@, –Ω–æ –ø–æ—Å–ª–µ %{penalty} –ø–æ–ø—ã—Ç–∫–∞ gent% [–æ–Ω/–æ–Ω–∞] –µ–µ –Ω–∞—Å—Ç–∏–≥ –∏ —Ä–µ—à–∏–ª —Å –ª–µ–≥–∫–æ—Å—Ç—å—é.",
        "[–£—á–µ–Ω–∏–∫/–£—á–µ–Ω–∏—Ü–∞] *{name}*, —Å %{penalty} –ø–æ–ø—ã—Ç–∫–∞ ablt%, [—Å–ø—Ä–∞–≤–∏–ª—Å—è/—Å–ø—Ä–∞–≤–∏–ª–∞—Å—å] —Å –∑–∞–¥–∞—á–µ–π *{task}* —Ç–∞–∫ –ª–µ–≥–∫–æ, —Å–ª–æ–≤–Ω–æ —ç—Ç–æ –±—ã–ª–∞ –∑–∞–¥–∞—á–∫–∞ –¥–ª—è –º–ª–∞–¥—à–∏—Ö –∫–ª–∞—Å—Å–æ–≤.",
        "[–£—á–µ–Ω–∏–∫/–£—á–µ–Ω–∏—Ü–∞] *{name}*, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ %{penalty} –æ—à–∏–±–∫–∞ accs%, —É—Å–ø–µ—à–Ω–æ [–≤—ã–ø–æ–ª–Ω–∏–ª/–≤—ã–ø–æ–ª–Ω–∏–ª–∞] –∑–∞–¥–∞–Ω–∏–µ *{task}*."
    ]),
    ({"verdict": "(RT)|(TL)|(PE)|(WA)", "penalty": "[1-9]0"}, [
        "–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å –Ω–µ –ø—Ä–µ–¥–µ–ª! –£ @*{name}* gent@ —É–∂–µ %{penalty} –ø–æ—Å—ã–ª–∫–∞ gent% –ø–æ –∑–∞–¥–∞—á–µ *{task}*.",
        "–£ @*{name}* gent@ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å—Ç–∞–ª–æ %{penalty} –ø–æ—Å—ã–ª–∫–∞ gent% –ø–æ –∑–∞–¥–∞—á–µ *{task}*. –ú–æ–∂–µ—Ç [–µ–º—É/–µ–π] —Å—Ç–æ–∏–ª–æ –≤—ã–±—Ä–∞—Ç—å –≥–µ–æ–≥—Ä–∞—Ñ–∏—é, –∞ –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ?",
        "*{name}* –ø–æ–ª—É—á–∞–µ—Ç %{penalty} —à—Ç—Ä–∞—Ñ gent% –ø–æ –∑–∞–¥–∞—á–µ *{task}*. –ö–∞–∂–µ—Ç—Å—è, –ø–æ—Ä–∞ –∑–∞–±—Ä–∞—Ç—å —É [–Ω–µ–≥–æ/–Ω–µ–µ] –Ω–æ—É—Ç–±—É–∫.",
        "*{name}* –Ω–∏–∫–∞–∫ –Ω–µ –º–æ–∂–µ—Ç —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –≤–µ—Ä–¥–∏–∫—Ç–æ–º *{verdict}* –≤ –∑–∞–¥–∞—á–µ *{task}*. –£ [–Ω–µ–≥–æ/–Ω–µ–µ] —É–∂–µ %*{penalty}* –ø–æ—Å—ã–ª–∫–∞ nomn%!"
    ]),
    ({"verdict": "RJ"}, [
        "BAN! *{name}* - *{task}*"
    ])
]

# TODO: autoloading with cutting
title_replacements = {
    '–°—Ç—Ä–æ–∫–∏ 3 üß∂': '–°—Ç—Ä–æ–∫–∏ 3 üß∂',
    '–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å': '–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å',
    '–î–µ–∫–∞—Ä—Ç–æ–≤–æ –¥–µ—Ä–µ–≤–æ ü§Æ': '–î–µ–∫–∞—Ä—Ç–æ–≤–æ –¥–µ—Ä–µ–≤–æ ü§Æ',
    '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ ü§¢': '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ ü§¢',
    '–ü–∞—Ä–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è üë´': '–ü–∞—Ä–æ—Å–æ—á–µ—Ç–∞–Ω–∏—è üë´',
    '–¢–µ–æ—Ä–∏—è –∏–≥—Ä ü§ì': '–¢–µ–æ—Ä–∏—è –∏–≥—Ä ü§ì',
    '–ì–µ–æ–º–µ—Ç—Ä–∏—è 2': '–ì–µ–æ–º–µ—Ç—Ä–∏—è 2',
    '–¢–µ–æ—Ä–∏—è –∏–≥—Ä ü§ì': '–¢–µ–æ—Ä–∏—è –∏–≥—Ä ü§ì',
    '–ì–µ–æ–º–µ—Ç—Ä–∏—è 2': '–ì–µ–æ–º–µ—Ç—Ä–∏—è 2',
    '–ö–æ—Ä–Ω–µ–≤–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è': '–ö–æ—Ä–Ω—è—á–∫–∞',
    '–ì—Ä–∞—Ñ—ã 4': '–ì—Ä–∞—Ñ—ã 4',
    '–ì–µ–æ–º–µ—Ç—Ä–∏—è 1': '–ì–µ–æ–º–µ—Ç—Ä–∏—è 1',
    '–ì—Ä–∞—Ñ—ã 3': '–ì—Ä–∞—Ñ—ã 3',
    '–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ 2': '–î–ü 2',
    '–î–µ—Ä–µ–≤–æ –æ—Ç—Ä–µ–∑–∫–æ–≤ 2': '–î–û 2',
    '–î–µ—Ä–µ–≤–æ –æ—Ç—Ä–µ–∑–∫–æ–≤ 1': '–î–û 1',
    '–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ 1': '–î–ü 1',
    '–ì—Ä–∞—Ñ—ã 2': '–ì—Ä–∞—Ñ—ã 2',
    '–ó–∞–¥–∞—á–∏ —Å –¥–≤–æ–π–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º': '–î–≤–æ–π–Ω–æ–π –∑–∞–ø—É—Å–∫',
    '–ë–∏–Ω–∞—Ä–Ω—ã–π –∏ —Ç–µ—Ä–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏': '–ü–æ–∏—Å–∫–∏+–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–∫–∏',
    '–¢–µ–æ—Ä–∏—è —á–∏—Å–µ–ª': '–¢–ß',
    'C++, —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–µ–±–∞–≥': '–î–µ–±–∞–≥',
    '–°—Ç—Ä–æ–∫–∏ 2': '–°—Ç—Ä–æ–∫–∏ 2',
    '–°—Ç—Ä–æ–∫–∏ 1': '–°—Ç—Ä–æ–∫–∏ 1',
    '–ì—Ä–∞—Ñ—ã 1': '–ì—Ä–∞—Ñ—ã 1'
}

reversed_title_replacements = {value: key for key, value in title_replacements.items()}

first_solve_message = "‚ö° *{name}* [—Å—Ç–∞–ª/—Å—Ç–∞–ª–∞] [–ø–µ—Ä–≤—ã–º/–ø–µ—Ä–≤–æ–π], –∫—Ç–æ —Ä–µ—à–∏–ª –∑–∞–¥–∞—á—É *{task}*!",

first_solves_message = """–ü–µ—Ä–≤—ã–µ —Ä–µ—à–∏–≤—à–∏–µ –∑–∞–¥–∞—á—É *{task}*:
ü•á{first}
ü•à{second}
ü•â{third}"""
